---
title: "Getting started with RLumCarlo"
author: "Sebastian Kreutzer, Johannes Friedrich, Vasilis Pagonis, Christoph Schmidt"
date: "Last modified: `r Sys.Date()`"
output: pdf_document
vignette: |
  %\VignetteIndexEntry{RLumCarlo - Getting started with RLumCarlo}         
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(RLumCarlo)
```

```{r, echo = FALSE, fig.align='center', message = FALSE}
knitr::include_graphics("../man/figures/Logo_RLumCarlo.png")
library(ggplot2)
library(scales)
library(kableExtra)

##https://github.com/JohannesFriedrich/EnergyBandModels
theme <- theme(axis.text = element_text(size = 14),
             axis.title = element_text(size = 14, face = "bold"),
             legend.text = element_text(size = 12),
             legend.title = element_text(size = 12, face = "bold"))

electrons <- data.frame(
  x = seq(0,1, length.out = 10),
  y = rep(c(-2.2,-1.5, -1, -0.6, -0.3, 0), each = 10)
)
```

# Scope

RLumCarlo is collection of energ-band models to simulate luminescence signal production using Monte-Carlo (MC) methods. This document aims at providing an overview and a brief introduction to RLumCarlo 
and on how to use the models. The first section, will, however, provide a brief introduction 
into RLumCarlo and how plot and extracts its data.

# A simple exlample

TODO

# The models in RLumCarlo

```{r, echo = FALSE, message=FALSE}
## extract models
models <- list.files("../R/", pattern = "run_")
models <- strtrim(models, nchar(models) - 2)
models <- regmatches(models, regexpr("(?<=run\\_).*", models, perl = TRUE), invert = FALSE)

## combine into data.frame
df <- data.frame(
  `MODEL NAME` = models, 
  `R CALL` = paste0("run_", models, "()"),
  `R FILE` = paste0("R/run_", models, ".R"),
  `MODE CORE` = paste0("src/MC_C_", models, ".cpp"))

knitr::kable(df) %>% kable_styling(full_width = T, font_size = 5)
```


# Figure 1

```{r Fig 1, fig.align='center'}
times <- seq(0, 5000)

## Run MC simulation
run_MC_ISO_TUN(E = 1.2,
           s = 1e10,
           T = 200,
           rho = 0.007,
           times = times) %>%
  plot_RLumCarlo(norm = T, legend = T)
```


# Figure 2

```{r Fig 2, fig.align='center'}
times <- seq(0, 1000)

## Run MC simulation
run_MC_CW_IRSL_TUN(A = 0.12, rho = 0.003, times = times) %>%
  plot_RLumCarlo(norm = T, legend = T)

run_MC_CW_IRSL_TUN(A = 0.21, rho = 0.003, times = times) %>%
  plot_RLumCarlo(norm = T, add = T)
```

# Figure 3

```{r Fig 3, fig.align='center'}
s <- 3.5e12
rho <- 0.015
E <- 1.45

times <- seq(100, 450) # time = temperature

results_rc0 <- run_MC_TL_TUN(s=s, E = E, rho = rho, r_c = 0, times = times) 
results_rc07 <- run_MC_TL_TUN(s=s, E = E, rho = rho, r_c = 0.7, times = times) 
results_rc077 <- run_MC_TL_TUN(s=s, E = E, rho = rho, r_c = 0.77, times = times) 
results_rc086 <- run_MC_TL_TUN(s=s, E = E, rho = rho, r_c = 0.86, times = times) 
```

```{r,Plot average signal, fig.align='center', echo = F}
plot_RLumCarlo(
  results = results_rc0, 
  type = "b",
  ylab = "normalized TL signal",
  xlab = "Temperature [Â°C]", 
  plot_uncertainty = FALSE,
  col = "black",
  norm = TRUE
  
)

plot_RLumCarlo(
  results_rc07,
  norm = TRUE,
  plot_uncertainty = FALSE,
  add = TRUE,
  col = "green",
  type = "p",
  pch = 6,
  
)


plot_RLumCarlo(
  results_rc077,
  norm = TRUE,
  plot_uncertainty = FALSE,
  add = TRUE,
  col = "blue",
  type = "p",
  pch = 4,
  
)

plot_RLumCarlo(
  results_rc086,
  norm = TRUE,
  plot_uncertainty = FALSE,
  add = TRUE,
  col = "red",
  type = "p",
  pch = 5,
  
)


legend(
  "topright",
  bty = "n",
  legend = c("0", "5", "10", "50"),
  pch = c(1, 6, 5, 4),
  col = c("black", "green", "blue", "red")
)


```

# Figure 4

```{r Fig 4, fig.align='center'}
## set parameters
s <- 3.5e12
rho <- 0.015
E <- 1.45
times <- seq(200, 500) # time = temperature
r_c <- c(0.85, 1.13, 1.3)

for(i in 1:length(r_c)){
  run_MC_TL_TUN(
    s = s,
    E = E,
    rho = rho,
    r_c = r_c[i],
    times = times
  ) %>%
  plot_RLumCarlo(legend = T, add = TRUE, col = i + 1)

}

```
