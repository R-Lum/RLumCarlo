---
title: "Getting started with RLumCarlo"
author: "Sebastian Kreutzer, Johannes Friedrich, Vasilis Pagonis, Christoph Schmidt"
date: "Last modified: `r Sys.Date()`"
output: pdf_document
vignette: |
  %\VignetteIndexEntry{RLumCarlo - Getting started with RLumCarlo}         
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo = FALSE, fig.align='center', message = FALSE}
knitr::include_graphics("../man/figures/Logo_RLumCarlo.png")

library(RLumCarlo)
library(ggplot2)
library(scales)

##https://github.com/JohannesFriedrich/EnergyBandModels
theme <- theme(axis.text = element_text(size = 14),
             axis.title = element_text(size = 14, face = "bold"),
             legend.text = element_text(size = 12),
             legend.title = element_text(size = 12, face = "bold"))

electrons <- data.frame(
  x = seq(0,1, length.out = 10),
  y = rep(c(-2.2,-1.5, -1, -0.6, -0.3, 0), each = 10)
)
```

# Scope

RLumCarlo is collection of energ-band models to simulate luminescence signal production using Monte-Carlo (MC) methods. This document aims at providing an overview and a brief introduction to RLumCarlo 
and on how to use the models. The first section, will, however, provide a brief introduction 
into RLumCarlo and how plot and extracts its data.

# A simple exlample

TODO

# The models in RLumCarlo

```{r, echo = FALSE, message=FALSE}
## extract models
models <- list.files("../R/", pattern = "run_")
models <- strtrim(models, nchar(models) - 2)
models <- regmatches(models, regexpr("(?<=run\\_).*", models, perl = TRUE), invert = FALSE)

## combine into data.frame
df <- data.frame(
  MODEL_NAME = models, 
  R_CALL = paste0("run_", models, "()"),
  R_FILE = paste0("R/run_", models, ".R"),
  MODE_CORE = paste0("src/MC_C_", models, ".cpp"))

knitr::kable(df)
```


# Figure 1

```{r Fig 1, fig.align='center'}
library(RLumCarlo)

times <- seq(0, 5000)

## Run MC simulation

run_MC_ISO(E = 1.2,
           s = 1e10,
           T = 200,
           rho = 0.007,
           times = times) %>%
  calc_RLumCarlo() %>%
  plot_RLumCarlo(norm = T, legend = T)
```


# Figure 2

```{r Fig 2, fig.align='center'}
times <- seq(0, 1000)

## Run MC simulation

run_MC_CW_IRSL(A = 0.12, rho = 0.003, times = times) %>%
calc_RLumCarlo() %>% plot_RLumCarlo(norm = T, legend = T)

run_MC_CW_IRSL(A = 0.21, rho = 0.003, times = times) %>%
calc_RLumCarlo() %>% plot_RLumCarlo(norm = T, add = T)
```

# Figure 3

```{r Fig 3, fig.align='center'}

s <- 3.5e12
rho <- 0.015
E <- 1.45

times <- seq(100, 450) # time = temperature

results_rc0 <- run_MC_TL(s=s, E = E, rho = rho, r_c = 0, times = times) %>% 
  calc_RLumCarlo()

results_rc07 <- run_MC_TL(s=s, E = E, rho = rho, r_c = 0.7, times = times) %>% 
  calc_RLumCarlo()

results_rc077 <- run_MC_TL(s=s, E = E, rho = rho, r_c = 0.77, times = times) %>% 
  calc_RLumCarlo()

results_rc086 <- run_MC_TL(s=s, E = E, rho = rho, r_c = 0.86, times = times) %>% 
  calc_RLumCarlo()
```

```{r,Plot average signal, fig.align='center', echo = F}

plot(
  x = times,
  y = results_rc0$avg/max(results_rc0$avg),
  type = "b",
  ylab = "normalized TL signal",
  xlab = "Temperature [Â°C]"
)
lines(
  x = times,
  y = results_rc07$avg/max(results_rc0$avg),
  type = "p",
  pch = 6,
  col = "green"
)
lines(
  x = times,
  y = results_rc077$avg/max(results_rc0$avg),
  type = "p",
  pch = 4,
  col = "blue"
)
lines(
  x = times,
  y = results_rc086$avg/max(results_rc0$avg),
  type = "b",
  pch = 5,
  col = "red"
)

legend("topright",
       legend = c("0", "5", "10", "50"),
       pch = c(1,6,5,4),
       col = c("black", "green", "blue", "red"))

grid()
```

# Figure 4

```{r Fig 4, fig.align='center'}
## set parameters
s <- 3.5e12
rho <- 0.015
E <- 1.45
times <- seq(200, 500) # time = temperature
r_c <- c(0.85, 1.13, 1.3)

for(i in 1:length(r_c)){
  run_MC_TL(
    s = s,
    E = E,
    rho = rho,
    r_c = r_c[i],
    times = times
  ) %>%
  calc_RLumCarlo() %>% 
  plot_RLumCarlo(legend = T, add = TRUE, col = i + 1)

}

```
