---
title: "Getting started with RLumCarlo"
author: "Sebastian Kreutzer, Johannes Friedrich, Vasilis Pagonis, Christoph Schmidt"
date: "Last modified: `r Sys.Date()`"
output: pdf_document
vignette: |
  %\VignetteIndexEntry{RLumCarlo - Getting started with RLumCarlo}         
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(RLumCarlo)
```

```{r, echo = FALSE, fig.align='center', message = FALSE}
knitr::include_graphics("../man/figures/Logo_RLumCarlo.png")
library(ggplot2)
library(scales)
library(kableExtra)

##https://github.com/JohannesFriedrich/EnergyBandModels
theme <- theme(axis.text = element_text(size = 14),
             axis.title = element_text(size = 14, face = "bold"),
             legend.text = element_text(size = 12),
             legend.title = element_text(size = 12, face = "bold"))

electrons <- data.frame(
  x = seq(0,1, length.out = 10),
  y = rep(c(-2.2,-1.5, -1, -0.6, -0.3, 0), each = 10)
)
```

# Scope

RLumCarlo is collection of energ-band models to simulate luminescence signal production using Monte-Carlo (MC) methods. This document aims at providing an overview and a brief introduction to RLumCarlo 
and on how to use the models. The first section, will, however, provide a brief introduction 
into RLumCarlo and how plot and extracts its data.

# A simple exlample

TODO

# The models in RLumCarlo

```{r, echo = FALSE, message=FALSE}
## extract models
models <- list.files("../R/", pattern = "run_")
models <- strtrim(models, nchar(models) - 2)
models <- regmatches(models, regexpr("(?<=run\\_).*", models, perl = TRUE), invert = FALSE)

## combine into data.frame
df <- data.frame(
  `MODEL NAME` = models, 
  `R CALL` = paste0("run_", models, "()"),
  `FILES` = paste0("R/run_", models, ".R \n src/MC_C_", models, ".cpp"), 
  stringsAsFactors = FALSE)

knitr::kable(df, booktabs = TRUE, linesep = "\\addlinespace") %>% 
  kable_styling(full_width = TRUE, font_size = 8) %>%
  column_spec(1, bold = TRUE)
```




# Figure 1

```{r Fig 1, fig.align='center'}
times <- seq(0, 5000)

## Run MC simulation
run_MC_ISO_TUN(E = 1.2,
           s = 1e10,
           T = 200,
           rho = 0.007,
           times = times) %>%
  plot_RLumCarlo(norm = TRUE, legend = TRUE)
```


# Figure 2

```{r Fig 2, fig.align='center'}
times <- seq(0, 1000)

## Run MC simulation
run_MC_CW_IRSL_TUN(A = 0.12, rho = 0.003, times = times) %>%
  plot_RLumCarlo(norm = T, legend = T)

run_MC_CW_IRSL_TUN(A = 0.21, rho = 0.003, times = times) %>%
  plot_RLumCarlo(norm = T, add = T)
```

# Figure 3

```{r Fig 3, fig.align='center', cache = TRUE}
s <- 3.5e12
rho <- 0.015
E <- 1.45
r_c <- c(0,0.7,0.77,0.86, 0.97)
times <- seq(100, 450) # time = temperature
results <- lapply(r_c, function(x) {
  run_MC_TL_TUN(
    s = s,
    E = E,
    rho = rho,
    r_c = x,
    times = times
  )
  
})
```

```{r,Plot average signal, fig.align='center', echo = TRUE, cache = TRUE}
plot_RLumCarlo(
  object = results, 
  ylab = "normalized TL signal",
  xlab = "Temperature [Â°C]", 
  plot_uncertainty = "range",
  legend = FALSE,
  col = c("black", "green", "blue", "red"),
  norm = TRUE
  
)

legend(
  "topright",
  bty = "n",
  legend = paste0("r_c: ", r_c),
  lty = 1,
  col = c("black", "green", "blue", "red")
)


```
